{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/FUNCTIONcalled_Workflow_Sidecar.schema.json",
  "title": "FUNCTIONcalled Workflow Metadata Sidecar",
  "description": "Metadata schema for GitHub Actions workflows following FUNCTIONcalled conventions",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "profile": {
      "type": "string",
      "enum": ["light", "full"],
      "description": "Metadata profile level - light for minimal, full for complete metadata"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the workflow"
    },
    "identifier": {
      "type": "string",
      "pattern": "^urn:uuid:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "Unique identifier in URN UUID format"
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "Semantic version of the workflow"
    },
    "description": {
      "type": "string",
      "description": "Brief description of what the workflow does"
    },
    "functioncalled": {
      "type": "object",
      "description": "FUNCTIONcalled naming convention metadata",
      "properties": {
        "canonical": {
          "type": "string",
          "pattern": "^(core|interface|logic|application)\\.[a-z][a-z0-9-]*\\.[a-z][a-z0-9-]*(\\.[a-z]+)?$",
          "description": "Canonical FUNCTIONcalled name (layer.role.domain[.ext])"
        },
        "layer": {
          "type": "string",
          "enum": ["core", "interface", "logic", "application"],
          "description": "FUNCTIONcalled layer classification"
        },
        "role": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "The role/responsibility of this workflow"
        },
        "domain": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "The domain/area this workflow operates in"
        }
      },
      "required": ["layer", "role", "domain"]
    },
    "schema:type": {
      "type": "string",
      "const": "SoftwareSourceCode",
      "description": "Schema.org type (always SoftwareSourceCode for workflows)"
    },
    "encodingFormat": {
      "type": "string",
      "enum": ["application/x-yaml", "text/yaml"],
      "description": "MIME type of the workflow file"
    },
    "programmingLanguage": {
      "type": "string",
      "const": "YAML",
      "description": "The language the workflow is written in"
    },
    "runtimePlatform": {
      "type": "string",
      "const": "GitHub Actions",
      "description": "The runtime platform for the workflow"
    },
    "triggers": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "push",
          "pull_request",
          "pull_request_review",
          "pull_request_review_comment",
          "pull_request_target",
          "check_suite",
          "workflow_dispatch",
          "workflow_call",
          "schedule",
          "release",
          "issues",
          "issue_comment",
          "discussion",
          "discussion_comment",
          "create",
          "delete",
          "deployment",
          "deployment_status",
          "fork",
          "gollum",
          "label",
          "milestone",
          "page_build",
          "project",
          "project_card",
          "project_column",
          "public",
          "registry_package",
          "repository_dispatch",
          "status",
          "watch",
          "workflow_run"
        ]
      },
      "description": "GitHub Actions event triggers"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Other workflows this workflow depends on"
    },
    "outputs": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" }
        },
        "required": ["name"]
      },
      "description": "Outputs produced by this workflow"
    },
    "dateCreated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 datetime when the workflow was created"
    },
    "dateModified": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 datetime when the workflow was last modified"
    },
    "creator": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" } }
      ],
      "description": "Creator(s) of the workflow"
    },
    "maintainer": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" } }
      ],
      "description": "Current maintainer(s) of the workflow"
    },
    "dc:subject": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" } }
      ],
      "description": "Subject keywords/tags"
    },
    "license": {
      "type": "string",
      "description": "License identifier (e.g., MIT, Apache-2.0)"
    }
  },
  "required": ["profile"],
  "allOf": [
    {
      "if": {
        "properties": { "profile": { "const": "light" } },
        "required": ["profile"]
      },
      "then": {
        "required": ["profile", "name", "identifier", "version"]
      }
    },
    {
      "if": {
        "properties": { "profile": { "const": "full" } },
        "required": ["profile"]
      },
      "then": {
        "required": [
          "profile",
          "name",
          "identifier",
          "version",
          "functioncalled",
          "schema:type",
          "encodingFormat",
          "dateCreated",
          "dateModified"
        ]
      }
    }
  ]
}
