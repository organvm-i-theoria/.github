name: Chatmode Frontmatter

on:
  pull_request:
    paths:
    - src/ai_framework/chatmodes/**
    - src/ai_framework/chatmodes/INVENTORY.md
    - src/ai_framework/agents/**
    - src/ai_framework/agents/INVENTORY.md
    - src/ai_framework/collections/**
    - src/ai_framework/collections/INVENTORY.md
    - src/automation/scripts/generate_chatmode_inventory.py
    - src/automation/scripts/generate_agent_inventory.py
    - src/automation/scripts/generate_collection_inventory.py
    - src/automation/scripts/validate_agent_frontmatter.py
    - src/automation/scripts/validate_collection_frontmatter.py
    - src/automation/scripts/validate_chatmode_frontmatter.py
  push:
    branches:
    - main
    paths:
    - src/ai_framework/chatmodes/**
    - src/ai_framework/chatmodes/INVENTORY.md
    - src/ai_framework/agents/**
    - src/ai_framework/agents/INVENTORY.md
    - src/ai_framework/collections/**
    - src/ai_framework/collections/INVENTORY.md
    - src/automation/scripts/generate_chatmode_inventory.py
    - src/automation/scripts/generate_agent_inventory.py
    - src/automation/scripts/generate_collection_inventory.py
    - src/automation/scripts/validate_agent_frontmatter.py
    - src/automation/scripts/validate_collection_frontmatter.py
    - src/automation/scripts/validate_chatmode_frontmatter.py
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
    - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5  # ratchet:actions/checkout@v4
    - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065  # ratchet:actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: pip
    - name: Validate chatmode frontmatter
      run: python src/automation/scripts/validate_chatmode_frontmatter.py
    - name: Verify chatmode inventory is up to date
      run: |
        python src/automation/scripts/generate_chatmode_inventory.py
        git diff --exit-code src/ai_framework/chatmodes/INVENTORY.md
    - name: Validate agent frontmatter
      run: python src/automation/scripts/validate_agent_frontmatter.py
    - name: Verify agent inventory is up to date
      run: |
        python src/automation/scripts/generate_agent_inventory.py
        git diff --exit-code src/ai_framework/agents/INVENTORY.md
    - name: Validate collection frontmatter
      run: python src/automation/scripts/validate_collection_frontmatter.py
    - name: Verify collection inventory is up to date
      run: |
        python src/automation/scripts/generate_collection_inventory.py
        git diff --exit-code src/ai_framework/collections/INVENTORY.md
