## 2024-02-12 - Functional Bug and XSS Mitigation
**Vulnerability:** The `generate_email_digest.py` script was vulnerable to XSS because it interpolated potentially untrusted data (metrics, events) directly into an HTML template without escaping. Additionally, it had a functional bug where it attempted to write the `html` module to a file instead of the generated HTML string.
**Learning:** Even internal reporting tools can be XSS vectors if they consume data that could be influenced by attackers (e.g., PR titles, branch names, or compromised metric files). Testing with realistic inputs is crucial to catch functional bugs like passing a module instead of a string.
**Prevention:** Always use `html.escape()` when inserting dynamic data into HTML templates. Ensure regression tests cover the full execution path, including file writing.
